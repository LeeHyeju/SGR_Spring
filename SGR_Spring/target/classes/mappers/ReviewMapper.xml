<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.project.mapper.ReviewMapper">

<!-- 검색하는 쿼리 -->
	<sql id="search">
		<if test="searchType != 'x'.toString() and searchType != null and searchType != ''.toString()">

			<!-- 아이디: i , 제목: t , 내용:: c -->
			<if test="searchType == 'i'.toString()">
				and mb_id like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 't'.toString()">
				and review_title like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 'c'.toString()">
				and review_content like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 'itc'.toString()">
				and ( mb_id like CONCAT('%', #{keyword}, '%')
				OR
				review_title
				like CONCAT('%', #{keyword}, '%')
				OR
				review_content 
				like CONCAT('%',#{keyword}, '%')
			</if>
		</if>
	</sql>

<select id="reviewList" resultType="ReviewDto">
	SELECT 
			review_no,
			goods_no,
			catesub_cd,
			mb_id,
			review_title,
			review_content,
			review_img,
			reg_date,
			review_hit
	FROM
			review
 	WHERE 
 			review_no > 0
 			<include refid="search"></include>
 	ORDER BY
 				review_no DESC,
				reg_date DESC
		limit #{pageStart}, #{perPageNum}		
</select>

<select id="reviewCount" resultType="Integer">
	SELECT 
				count(review_no)
	FROM
			  	review
	WHERE
				review_no > 0
	<include refid="search"></include>			
</select>


<select id="view" resultType="ReviewDto">
	SELECT 
			review_no,
			goods_no,
			catesub_cd,
			mb_id,
			review_title,
			review_content,
			review_img,
			reg_date,
			review_hit
	FROM
			review
	WHERE
			review_no = #{review_no}
</select>

<update id="hit">
UPDATE 	
			review
SET
		  review_hit = review_hit + 1
WHERE
			review_no = #{review_no}		  		
</update>

<insert id="write">
INSERT INTO
					review (
					goods_no, 
					catesub_cd,
					mb_id,
					review_title,
					review_content
					)
VALUES 				
					(
					#{goods_no}, 
					#{catesub_cd},
					#{mb_id},
					#{review_title},
					#{review_content}
					)
</insert>


<update id="update">
UPDATE 
			review
SET 
		review_title =#{review_title}, 
		review_content =#{review_content}
WHERE 
		review_no=#{review_no}
</update>

<delete id="delete">
DELETE

FROM
		review
WHERE
		review_no=#{review_no}

</delete>
</mapper>